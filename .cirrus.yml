---

matrix_experiment_task:

  container:
    image: python:3.10

  name: Execute a set of similar tasks
  only_if: $CIRRUS_BRANCH =~ 'master'
  matrix:
    - environment:
        AGENT_ID: cirrusci_001
        GIT_SSH_PRIV_KEY: ENCRYPTED[!d28c304d8f0f92eb1febb673dc51d602398f9bae77af36a38d42d145c8b28512f4fba2820444dbd5c07c88cc90353a54!]
        GIT_REMOTE: ENCRYPTED[!cdb3611d249b885d9dc09fa87dd1b4b1c58dbae766f1a9ac856be0fb31207e7c3de33b31337f46f58f1f3e4291fcd7fa!]

    - environment:
        AGENT_ID: cirrusci_002
        GIT_SSH_PRIV_KEY: ENCRYPTED[!d28c304d8f0f92eb1febb673dc51d602398f9bae77af36a38d42d145c8b28512f4fba2820444dbd5c07c88cc90353a54!]
        GIT_REMOTE: ENCRYPTED[!cdb3611d249b885d9dc09fa87dd1b4b1c58dbae766f1a9ac856be0fb31207e7c3de33b31337f46f58f1f3e4291fcd7fa!]

    - environment:
        AGENT_ID: cirrusci_003
        GIT_SSH_PRIV_KEY: ENCRYPTED[!d28c304d8f0f92eb1febb673dc51d602398f9bae77af36a38d42d145c8b28512f4fba2820444dbd5c07c88cc90353a54!]
        GIT_REMOTE: ENCRYPTED[!cdb3611d249b885d9dc09fa87dd1b4b1c58dbae766f1a9ac856be0fb31207e7c3de33b31337f46f58f1f3e4291fcd7fa!]

  env_printout_script:
    - echo "AGENT_ID=${AGENT_ID}"
    - echo "${GIT_SSH_PRIV_KEY}" > id_ed25519_git
    - chmod 400 id_ed25519_git
    - ssh-add id_ed25519_git
    - mkdir "repo"
    - git clone "${GIT_REMOTE}" "repo"
    - cd "repo"
    - pip install -r requirements.txt
    - python3 src/9gag_post_download_agent.py


...
